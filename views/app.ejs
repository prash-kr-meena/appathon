<!DOCTYPE html>
<html>

<head>
    <title>Simple Map</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <style>
        /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
        #map {
            float: right;
            height: 90%;
            width: 62%;
        }

        #content {
            float: left;
            /* border: 1px solid red; */
            height: 90%;
            width: 38%;
        }

        .filter-bar {
            border: 1px solid blue;
            position: static;
            height: 10%;
            width: 100%;
        }

        /* Optional: Makes the sample page fill the window. */
        html,
        body {
            max-width: 100%;
            overflow-x: hidden;
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>
    <script>
        let google_maps_js_API_with_my_key = "https://maps.googleapis.com/maps/api/js?key=" +
            "<%= config.google_maps_js_API_Key %>" + "&callback=initMap"
    </script>
</head>

<body>

    <div class="filter-bar"></div>
    <div id="content"></div>
    <div id="map"></div>



</body>


<script>
    loadScript("google_maps_js_API_with_my_key", google_maps_js_API_with_my_key, false); // NOT a critical script
    // console.log(google_maps_js_API_with_my_key);
    let map;

    let center_location = {
        lat: 28.7041,
        lng: 77.1025
    };

    let markers = [{
            marker: undefined,
            title: "DELHI",
            marker_location: {
                lat: 28.7041, // DELHI
                lng: 77.1025
            }
        },
        {
            marker: undefined,
            title: "MUMBAI",
            marker_location: {
                lat: 19.0760, // MUMBAI
                lng: 72.8777
            }
        },
        {
            marker: undefined,
            title: "RAJASTHAN",
            marker_location: {
                lat: 26.9124, // RAJASTHAN
                lng: 75.7873
            }
        },
    ];

    function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
            center: center_location,
            zoom: 7,
            gestureHandling: 'cooperative',

        });

        add_markers(map);
    }

    function add_markers(map) {
        // console.log(map);
        var iconBase = 'https://maps.google.com/mapfiles/kml/shapes/';
        markers.forEach(cur_marker => {
            // console.log(cur_marker);
            let marker = new google.maps.Marker({ //  create marker
                map: map,
                position: cur_marker.marker_location,
                draggable: false,
                animation: google.maps.Animation.DROP,
                // icon : "./cartoon car.png"
                // icon: iconBase + 'parking_lot_maps.png',',
                title: cur_marker.title
            });

            let infoWindow = new google.maps.InfoWindow({ // create info window
                content: "<h1>hello there</h1>"
            });

            marker.addListener('click', function () {
                infoWindow.open(map, marker);
            });

            cur_marker.marker = marker; // no longer undefined
        });


    }


    function loadScript(script_name, url, is_critical_script, callback) {
        let kill_time = 4000;

        let script = document.createElement("script")
        script.type = "text/javascript";
        script.src = url;
        document.getElementsByTagName("head")[0].appendChild(script);

        script.onload = function () {
            console.log(script_name + " : script is loaded SUCCESSFULLY");
            window.clearTimeout(timeOut_id);
        };

        script.onerror = function () {
            let message = script_name + " : script NOT loaded     ERROR  --CONNECTION PROBLEM-- ";
            alert(message);
            window.clearTimeout(timeOut_id);
            if (is_critical_script)
                throw new Error(message);
        }

        // if the script can't be loaded
        let timeOut_id = window.setTimeout(() => {
            let message = script_name + " : script NOT loaded     ERROR  --CONNECTION PROBLEM-- ";
            alert(message);

            if (is_critical_script)
                throw new Error(message);
        }, kill_time);

        // newScript = document.createElement('script');
        // newScript.setAttribute('type', 'text/javascript');
        // newScript.setAttribute('src', 'file.js');

    }
</script>

</html>